version: '3.8'

services:
  controller:
    build:
      context: ..
      dockerfile: docker/Dockerfile
    container_name: zeno-dev
    env_file:
      - ../.env
    environment:
      - ENV=development
      - LOG_LEVEL=debug
      - RUNNER_PROVIDER=docker
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - ../:/app  # Mount source for live reload
      - go-mod-cache:/go/pkg/mod
    ports:
      - "8080:8080"
      - "9090:9090"
      - "2345:2345"  # Delve debugger
    command: |
      sh -c "apk add --no-cache air && air"
    networks:
      - runner-network-dev
    working_dir: /app

networks:
  runner-network-dev:
    driver: bridge

volumes:
  go-mod-cache:
